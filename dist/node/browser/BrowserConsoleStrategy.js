"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BrowserConsoleStrategy = void 0;
const LogStrategy_1 = require("../logging/LogStrategy");
class BrowserConsoleStrategy extends LogStrategy_1.LogStrategy {
    constructor(maxStringLength = 5000, maxDepth = 10) {
        super();
        this.MAX_STRING_LENGTH = maxStringLength;
        this.MAX_DEPTH = maxDepth;
    }
    isLogMessage(body) {
        return (typeof body === "object" &&
            body !== null &&
            "timestamp" in body &&
            "level" in body &&
            "message" in body);
    }
    async sendPackaged(packagedMessage, options) {
        const { header, body } = packagedMessage;
        const logLevel = options?.logLevel || LogStrategy_1.LogLevel.INFO;
        if (this.isLogMessage(body)) {
            this.formatLogMessage(body, header.requestId);
        }
        else {
            this.formatGenericMessage(body, logLevel, header.timestamp, header.requestId);
        }
    }
    formatLogMessage(logMessage, requestId) {
        const { sender, timestamp, level, message, payload } = logMessage;
        const logLevel = parseInt(level) || LogStrategy_1.LogLevel.INFO;
        const color = BrowserConsoleStrategy.LOG_COLORS[logLevel];
        console.groupCollapsed(`%c[${logLevel}] ${new Date(timestamp).toISOString()}`, color);
        if (sender) {
            console.log(`Sender: ${sender}`);
        }
        console.log(`Message: ${message}`);
        console.log(`RequestID: ${requestId}`);
        if (payload) {
            console.log("Payload:", payload);
        }
        console.groupEnd();
    }
    formatGenericMessage(message, logLevel, timestamp, requestId) {
        const color = BrowserConsoleStrategy.LOG_COLORS[logLevel];
        console.groupCollapsed(`%c[${logLevel}] ${new Date(timestamp).toISOString()}`, color);
        console.log(`RequestID: ${requestId}`);
        if (typeof message === "object" && message !== null) {
            console.log("Message:", message);
        }
        else {
            console.log(`Message: ${message}`);
        }
        console.groupEnd();
    }
    async log(message, logLevel = LogStrategy_1.LogLevel.INFO) {
        await this.send(message, { logLevel });
    }
    async info(message, data) {
        await this.log({ message, data }, LogStrategy_1.LogLevel.INFO);
    }
    async warn(message, data) {
        await this.log({ message, data }, LogStrategy_1.LogLevel.WARN);
    }
    async error(message, data) {
        await this.log({ message, data }, LogStrategy_1.LogLevel.ERROR);
    }
    async debug(message, data) {
        await this.log({ message, data }, LogStrategy_1.LogLevel.DEBUG);
    }
}
exports.BrowserConsoleStrategy = BrowserConsoleStrategy;
BrowserConsoleStrategy.LOG_COLORS = {
    [LogStrategy_1.LogLevel.INFO]: "color: blue",
    [LogStrategy_1.LogLevel.WARN]: "color: orange",
    [LogStrategy_1.LogLevel.ERROR]: "color: red",
    [LogStrategy_1.LogLevel.DEBUG]: "color: green",
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnJvd3NlckNvbnNvbGVTdHJhdGVneS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9icm93c2VyL0Jyb3dzZXJDb25zb2xlU3RyYXRlZ3kudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0Esd0RBQTJFO0FBRTNFLE1BQWEsc0JBQXVCLFNBQVEseUJBQVc7SUFRckQsWUFBWSxlQUFlLEdBQUcsSUFBSSxFQUFFLFFBQVEsR0FBRyxFQUFFO1FBQy9DLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLGVBQWUsQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQztJQUM1QixDQUFDO0lBRU8sWUFBWSxDQUFDLElBQVM7UUFDNUIsT0FBTyxDQUNMLE9BQU8sSUFBSSxLQUFLLFFBQVE7WUFDeEIsSUFBSSxLQUFLLElBQUk7WUFDYixXQUFXLElBQUksSUFBSTtZQUNuQixPQUFPLElBQUksSUFBSTtZQUNmLFNBQVMsSUFBSSxJQUFJLENBQ2xCLENBQUM7SUFDSixDQUFDO0lBRVMsS0FBSyxDQUFDLFlBQVksQ0FDMUIsZUFBOEIsRUFDOUIsT0FBNkI7UUFFN0IsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxlQUFlLENBQUM7UUFDekMsTUFBTSxRQUFRLEdBQUksT0FBTyxFQUFFLFFBQXFCLElBQUksc0JBQVEsQ0FBQyxJQUFJLENBQUM7UUFFbEUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEQsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsb0JBQW9CLENBQ3ZCLElBQUksRUFDSixRQUFRLEVBQ1IsTUFBTSxDQUFDLFNBQVMsRUFDaEIsTUFBTSxDQUFDLFNBQVMsQ0FDakIsQ0FBQztRQUNKLENBQUM7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LEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFFLHNCQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDcEQsQ0FBQzs7QUE1R0gsd0RBNkdDO0FBNUd5QixpQ0FBVSxHQUFHO0lBQ25DLENBQUMsc0JBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxhQUFhO0lBQzlCLENBQUMsc0JBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxlQUFlO0lBQ2hDLENBQUMsc0JBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxZQUFZO0lBQzlCLENBQUMsc0JBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxjQUFjO0NBQ2pDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUmVxdWVzdCB9IGZyb20gXCIuLi9pbnRlcmZhY2VzXCI7XG5pbXBvcnQgeyBMb2dMZXZlbCwgTG9nTWVzc2FnZSwgTG9nU3RyYXRlZ3kgfSBmcm9tIFwiLi4vbG9nZ2luZy9Mb2dTdHJhdGVneVwiO1xuXG5leHBvcnQgY2xhc3MgQnJvd3NlckNvbnNvbGVTdHJhdGVneSBleHRlbmRzIExvZ1N0cmF0ZWd5IHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTE9HX0NPTE9SUyA9IHtcbiAgICBbTG9nTGV2ZWwuSU5GT106IFwiY29sb3I6IGJsdWVcIixcbiAgICBbTG9nTGV2ZWwuV0FSTl06IFwiY29sb3I6IG9yYW5nZVwiLFxuICAgIFtMb2dMZXZlbC5FUlJPUl06IFwiY29sb3I6IHJlZFwiLFxuICAgIFtMb2dMZXZlbC5ERUJVR106IFwiY29sb3I6IGdyZWVuXCIsXG4gIH07XG5cbiAgY29uc3RydWN0b3IobWF4U3RyaW5nTGVuZ3RoID0gNTAwMCwgbWF4RGVwdGggPSAxMCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5NQVhfU1RSSU5HX0xFTkdUSCA9IG1heFN0cmluZ0xlbmd0aDtcbiAgICB0aGlzLk1BWF9ERVBUSCA9IG1heERlcHRoO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0xvZ01lc3NhZ2UoYm9keTogYW55KTogYm9keSBpcyBMb2dNZXNzYWdlIHtcbiAgICByZXR1cm4gKFxuICAgICAgdHlwZW9mIGJvZHkgPT09IFwib2JqZWN0XCIgJiZcbiAgICAgIGJvZHkgIT09IG51bGwgJiZcbiAgICAgIFwidGltZXN0YW1wXCIgaW4gYm9keSAmJlxuICAgICAgXCJsZXZlbFwiIGluIGJvZHkgJiZcbiAgICAgIFwibWVzc2FnZVwiIGluIGJvZHlcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFzeW5jIHNlbmRQYWNrYWdlZChcbiAgICBwYWNrYWdlZE1lc3NhZ2U6IElSZXF1ZXN0PGFueT4sXG4gICAgb3B0aW9ucz86IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgeyBoZWFkZXIsIGJvZHkgfSA9IHBhY2thZ2VkTWVzc2FnZTtcbiAgICBjb25zdCBsb2dMZXZlbCA9IChvcHRpb25zPy5sb2dMZXZlbCBhcyBMb2dMZXZlbCkgfHwgTG9nTGV2ZWwuSU5GTztcblxuICAgIGlmICh0aGlzLmlzTG9nTWVzc2FnZShib2R5KSkge1xuICAgICAgdGhpcy5mb3JtYXRMb2dNZXNzYWdlKGJvZHksIGhlYWRlci5yZXF1ZXN0SWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmZvcm1hdEdlbmVyaWNNZXNzYWdlKFxuICAgICAgICBib2R5LFxuICAgICAgICBsb2dMZXZlbCxcbiAgICAgICAgaGVhZGVyLnRpbWVzdGFtcCxcbiAgICAgICAgaGVhZGVyLnJlcXVlc3RJZFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdExvZ01lc3NhZ2UobG9nTWVzc2FnZTogTG9nTWVzc2FnZSwgcmVxdWVzdElkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCB7IHNlbmRlciwgdGltZXN0YW1wLCBsZXZlbCwgbWVzc2FnZSwgcGF5bG9hZCB9ID0gbG9nTWVzc2FnZTtcbiAgICBjb25zdCBsb2dMZXZlbCA9IChwYXJzZUludChsZXZlbCkgYXMgTG9nTGV2ZWwpIHx8IExvZ0xldmVsLklORk87XG4gICAgY29uc3QgY29sb3IgPSBCcm93c2VyQ29uc29sZVN0cmF0ZWd5LkxPR19DT0xPUlNbbG9nTGV2ZWxdO1xuXG4gICAgY29uc29sZS5ncm91cENvbGxhcHNlZChcbiAgICAgIGAlY1ske2xvZ0xldmVsfV0gJHtuZXcgRGF0ZSh0aW1lc3RhbXApLnRvSVNPU3RyaW5nKCl9YCxcbiAgICAgIGNvbG9yXG4gICAgKTtcblxuICAgIGlmIChzZW5kZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBTZW5kZXI6ICR7c2VuZGVyfWApO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhgTWVzc2FnZTogJHttZXNzYWdlfWApO1xuICAgIGNvbnNvbGUubG9nKGBSZXF1ZXN0SUQ6ICR7cmVxdWVzdElkfWApO1xuXG4gICAgaWYgKHBheWxvYWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiUGF5bG9hZDpcIiwgcGF5bG9hZCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5ncm91cEVuZCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRHZW5lcmljTWVzc2FnZShcbiAgICBtZXNzYWdlOiBhbnksXG4gICAgbG9nTGV2ZWw6IExvZ0xldmVsLFxuICAgIHRpbWVzdGFtcDogbnVtYmVyLFxuICAgIHJlcXVlc3RJZDogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IGNvbG9yID0gQnJvd3NlckNvbnNvbGVTdHJhdGVneS5MT0dfQ09MT1JTW2xvZ0xldmVsXTtcblxuICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoXG4gICAgICBgJWNbJHtsb2dMZXZlbH1dICR7bmV3IERhdGUodGltZXN0YW1wKS50b0lTT1N0cmluZygpfWAsXG4gICAgICBjb2xvclxuICAgICk7XG5cbiAgICBjb25zb2xlLmxvZyhgUmVxdWVzdElEOiAke3JlcXVlc3RJZH1gKTtcblxuICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gXCJvYmplY3RcIiAmJiBtZXNzYWdlICE9PSBudWxsKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk1lc3NhZ2U6XCIsIG1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgTWVzc2FnZTogJHttZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgfVxuXG4gIGFzeW5jIGxvZyhtZXNzYWdlOiBhbnksIGxvZ0xldmVsOiBMb2dMZXZlbCA9IExvZ0xldmVsLklORk8pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnNlbmQobWVzc2FnZSwgeyBsb2dMZXZlbCB9KTtcbiAgfVxuXG4gIGFzeW5jIGluZm8obWVzc2FnZTogYW55LCBkYXRhPzogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5sb2coeyBtZXNzYWdlLCBkYXRhIH0sIExvZ0xldmVsLklORk8pO1xuICB9XG5cbiAgYXN5bmMgd2FybihtZXNzYWdlOiBhbnksIGRhdGE/OiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZyh7IG1lc3NhZ2UsIGRhdGEgfSwgTG9nTGV2ZWwuV0FSTik7XG4gIH1cblxuICBhc3luYyBlcnJvcihtZXNzYWdlOiBhbnksIGRhdGE/OiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZyh7IG1lc3NhZ2UsIGRhdGEgfSwgTG9nTGV2ZWwuRVJST1IpO1xuICB9XG5cbiAgYXN5bmMgZGVidWcobWVzc2FnZTogYW55LCBkYXRhPzogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5sb2coeyBtZXNzYWdlLCBkYXRhIH0sIExvZ0xldmVsLkRFQlVHKTtcbiAgfVxufVxuIl19