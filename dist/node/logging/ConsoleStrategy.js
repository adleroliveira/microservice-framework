"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConsoleStrategy = void 0;
const LogStrategy_1 = require("./LogStrategy");
const chalk_1 = __importDefault(require("chalk"));
var LogLevel;
(function (LogLevel) {
    LogLevel["INFO"] = "INFO";
    LogLevel["WARN"] = "WARN";
    LogLevel["ERROR"] = "ERROR";
    LogLevel["DEBUG"] = "DEBUG";
})(LogLevel || (LogLevel = {}));
class ConsoleStrategy extends LogStrategy_1.LogStrategy {
    constructor(maxStringLength = 5000, maxDepth = 10) {
        super();
        this.MAX_STRING_LENGTH = maxStringLength;
        this.MAX_DEPTH = maxDepth;
    }
    isLogMessage(body) {
        return (typeof body === "object" &&
            body !== null &&
            "timestamp" in body &&
            "level" in body &&
            "message" in body);
    }
    async sendPackaged(packagedMessage, options) {
        const { header, body } = packagedMessage;
        const logLevel = options?.logLevel || LogLevel.INFO;
        const formattedMessage = this.isLogMessage(body)
            ? this.formatLogMessage(body, header.requestId)
            : this.formatGenericMessage(body, logLevel, header.timestamp, header.requestId);
        console.log(formattedMessage);
    }
    formatLogMessage(logMessage, requestId) {
        const { sender, timestamp, level, message, payload } = logMessage;
        const logLevel = level.toUpperCase();
        const color = ConsoleStrategy.LOG_COLORS[logLevel] || chalk_1.default.white;
        let formattedMessage = color(`[${logLevel}] ${new Date(timestamp).toISOString()}` // - RequestID: ${requestId}`
        );
        if (sender) {
            formattedMessage += color(` [${sender}]`);
        }
        formattedMessage += color(` - ${message}`);
        if (payload) {
            formattedMessage += "\n" + this.formatPayload(payload, "  ");
        }
        return formattedMessage;
    }
    formatGenericMessage(message, logLevel, timestamp, requestId) {
        const color = ConsoleStrategy.LOG_COLORS[logLevel];
        let formattedMessage = color(`[${logLevel}] ${new Date(timestamp).toISOString()} - RequestID: ${requestId} - `);
        if (typeof message === "object" && message !== null) {
            formattedMessage += "\n" + this.formatPayload(message, "  ");
        }
        else {
            formattedMessage += message;
        }
        return formattedMessage;
    }
    formatPayload(payload, indent = "") {
        if (typeof payload !== "object" || payload === null) {
            return `${indent}${payload}`;
        }
        return Object.entries(payload)
            .map(([key, value]) => {
            if (typeof value === "object" && value !== null) {
                return `${indent}${key}:\n${this.formatPayload(value, indent + "  ")}`;
            }
            return `${indent}${key}: ${value}`;
        })
            .join("\n");
    }
    async log(message, logLevel = LogLevel.INFO) {
        await this.send(message, { logLevel });
    }
    async info(message) {
        await this.log(message, LogLevel.INFO);
    }
    async warn(message) {
        await this.log(message, LogLevel.WARN);
    }
    async error(message) {
        await this.log(message, LogLevel.ERROR);
    }
    async debug(message) {
        await this.log(message, LogLevel.DEBUG);
    }
    logFromRequest(request) {
        this.sendPackaged(request);
    }
}
exports.ConsoleStrategy = ConsoleStrategy;
ConsoleStrategy.LOG_COLORS = {
    [LogLevel.INFO]: chalk_1.default.blue,
    [LogLevel.WARN]: chalk_1.default.yellow,
    [LogLevel.ERROR]: chalk_1.default.red,
    [LogLevel.DEBUG]: chalk_1.default.green,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uc29sZVN0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xvZ2dpbmcvQ29uc29sZVN0cmF0ZWd5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLCtDQUE0QztBQUU1QyxrREFBMEI7QUFFMUIsSUFBSyxRQUtKO0FBTEQsV0FBSyxRQUFRO0lBQ1gseUJBQWEsQ0FBQTtJQUNiLHlCQUFhLENBQUE7SUFDYiwyQkFBZSxDQUFBO0lBQ2YsMkJBQWUsQ0FBQTtBQUNqQixDQUFDLEVBTEksUUFBUSxLQUFSLFFBQVEsUUFLWjtBQWNELE1BQWEsZUFBZ0IsU0FBUSx5QkFBVztJQVE5QyxZQUFZLGVBQWUsR0FBRyxJQUFJLEVBQUUsUUFBUSxHQUFHLEVBQUU7UUFDL0MsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsaUJBQWlCLEdBQUcsZUFBZSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO0lBQzVCLENBQUM7SUFFTyxZQUFZLENBQUMsSUFBUztRQUM1QixPQUFPLENBQ0wsT0FBTyxJQUFJLEtBQUssUUFBUTtZQUN4QixJQUFJLEtBQUssSUFBSTtZQUNiLFdBQVcsSUFBSSxJQUFJO1lBQ25CLE9BQU8sSUFBSSxJQUFJO1lBQ2YsU0FBUyxJQUFJLElBQUksQ0FDbEIsQ0FBQztJQUNKLENBQUM7SUFFUyxLQUFLLENBQUMsWUFBWSxDQUMxQixlQUE4QixFQUM5QixPQUE2QjtRQUU3QixNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLGVBQWUsQ0FBQztRQUN6QyxNQUFNLFFBQVEsR0FBSSxPQUFPLEVBQUUsUUFBcUIsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDO1FBRWxFLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7WUFDOUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFD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YXRlZ3kgfSBmcm9tIFwiLi9Mb2dTdHJhdGVneVwiO1xuaW1wb3J0IHsgSVJlcXVlc3QgfSBmcm9tIFwiLi4vaW50ZXJmYWNlc1wiO1xuaW1wb3J0IGNoYWxrIGZyb20gXCJjaGFsa1wiO1xuXG5lbnVtIExvZ0xldmVsIHtcbiAgSU5GTyA9IFwiSU5GT1wiLFxuICBXQVJOID0gXCJXQVJOXCIsXG4gIEVSUk9SID0gXCJFUlJPUlwiLFxuICBERUJVRyA9IFwiREVCVUdcIixcbn1cblxuaW50ZXJmYWNlIExvZ01lc3NhZ2Uge1xuICBzZW5kZXI/OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICBsZXZlbDogc3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIHBheWxvYWQ/OiBhbnk7XG59XG5cbmludGVyZmFjZSBMb2dQYXlsb2FkIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5leHBvcnQgY2xhc3MgQ29uc29sZVN0cmF0ZWd5IGV4dGVuZHMgTG9nU3RyYXRlZ3kge1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBMT0dfQ09MT1JTID0ge1xuICAgIFtMb2dMZXZlbC5JTkZPXTogY2hhbGsuYmx1ZSxcbiAgICBbTG9nTGV2ZWwuV0FSTl06IGNoYWxrLnllbGxvdyxcbiAgICBbTG9nTGV2ZWwuRVJST1JdOiBjaGFsay5yZWQsXG4gICAgW0xvZ0xldmVsLkRFQlVHXTogY2hhbGsuZ3JlZW4sXG4gIH07XG5cbiAgY29uc3RydWN0b3IobWF4U3RyaW5nTGVuZ3RoID0gNTAwMCwgbWF4RGVwdGggPSAxMCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5NQVhfU1RSSU5HX0xFTkdUSCA9IG1heFN0cmluZ0xlbmd0aDtcbiAgICB0aGlzLk1BWF9ERVBUSCA9IG1heERlcHRoO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0xvZ01lc3NhZ2UoYm9keTogYW55KTogYm9keSBpcyBMb2dNZXNzYWdlIHtcbiAgICByZXR1cm4gKFxuICAgICAgdHlwZW9mIGJvZHkgPT09IFwib2JqZWN0XCIgJiZcbiAgICAgIGJvZHkgIT09IG51bGwgJiZcbiAgICAgIFwidGltZXN0YW1wXCIgaW4gYm9keSAmJlxuICAgICAgXCJsZXZlbFwiIGluIGJvZHkgJiZcbiAgICAgIFwibWVzc2FnZVwiIGluIGJvZHlcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFzeW5jIHNlbmRQYWNrYWdlZChcbiAgICBwYWNrYWdlZE1lc3NhZ2U6IElSZXF1ZXN0PGFueT4sXG4gICAgb3B0aW9ucz86IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgeyBoZWFkZXIsIGJvZHkgfSA9IHBhY2thZ2VkTWVzc2FnZTtcbiAgICBjb25zdCBsb2dMZXZlbCA9IChvcHRpb25zPy5sb2dMZXZlbCBhcyBMb2dMZXZlbCkgfHwgTG9nTGV2ZWwuSU5GTztcblxuICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSB0aGlzLmlzTG9nTWVzc2FnZShib2R5KVxuICAgICAgPyB0aGlzLmZvcm1hdExvZ01lc3NhZ2UoYm9keSwgaGVhZGVyLnJlcXVlc3RJZClcbiAgICAgIDogdGhpcy5mb3JtYXRHZW5lcmljTWVzc2FnZShcbiAgICAgICAgICBib2R5LFxuICAgICAgICAgIGxvZ0xldmVsLFxuICAgICAgICAgIGhlYWRlci50aW1lc3RhbXAsXG4gICAgICAgICAgaGVhZGVyLnJlcXVlc3RJZFxuICAgICAgICApO1xuXG4gICAgY29uc29sZS5sb2coZm9ybWF0dGVkTWVzc2FnZSk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdExvZ01lc3NhZ2UobG9nTWVzc2FnZTogTG9nTWVzc2FnZSwgcmVxdWVzdElkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgc2VuZGVyLCB0aW1lc3RhbXAsIGxldmVsLCBtZXNzYWdlLCBwYXlsb2FkIH0gPSBsb2dNZXNzYWdlO1xuICAgIGNvbnN0IGxvZ0xldmVsID0gbGV2ZWwudG9VcHBlckNhc2UoKSBhcyBMb2dMZXZlbDtcbiAgICBjb25zdCBjb2xvciA9IENvbnNvbGVTdHJhdGVneS5MT0dfQ09MT1JTW2xvZ0xldmVsXSB8fCBjaGFsay53aGl0ZTtcblxuICAgIGxldCBmb3JtYXR0ZWRNZXNzYWdlID0gY29sb3IoXG4gICAgICBgWyR7bG9nTGV2ZWx9XSAke25ldyBEYXRlKHRpbWVzdGFtcCkudG9JU09TdHJpbmcoKX1gIC8vIC0gUmVxdWVzdElEOiAke3JlcXVlc3RJZH1gXG4gICAgKTtcblxuICAgIGlmIChzZW5kZXIpIHtcbiAgICAgIGZvcm1hdHRlZE1lc3NhZ2UgKz0gY29sb3IoYCBbJHtzZW5kZXJ9XWApO1xuICAgIH1cblxuICAgIGZvcm1hdHRlZE1lc3NhZ2UgKz0gY29sb3IoYCAtICR7bWVzc2FnZX1gKTtcblxuICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICBmb3JtYXR0ZWRNZXNzYWdlICs9IFwiXFxuXCIgKyB0aGlzLmZvcm1hdFBheWxvYWQocGF5bG9hZCwgXCIgIFwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZm9ybWF0dGVkTWVzc2FnZTtcbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0R2VuZXJpY01lc3NhZ2UoXG4gICAgbWVzc2FnZTogYW55LFxuICAgIGxvZ0xldmVsOiBMb2dMZXZlbCxcbiAgICB0aW1lc3RhbXA6IG51bWJlcixcbiAgICByZXF1ZXN0SWQ6IHN0cmluZ1xuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbG9yID0gQ29uc29sZVN0cmF0ZWd5LkxPR19DT0xPUlNbbG9nTGV2ZWxdO1xuICAgIGxldCBmb3JtYXR0ZWRNZXNzYWdlID0gY29sb3IoXG4gICAgICBgWyR7bG9nTGV2ZWx9XSAke25ldyBEYXRlKFxuICAgICAgICB0aW1lc3RhbXBcbiAgICAgICkudG9JU09TdHJpbmcoKX0gLSBSZXF1ZXN0SUQ6ICR7cmVxdWVzdElkfSAtIGBcbiAgICApO1xuXG4gICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSBcIm9iamVjdFwiICYmIG1lc3NhZ2UgIT09IG51bGwpIHtcbiAgICAgIGZvcm1hdHRlZE1lc3NhZ2UgKz0gXCJcXG5cIiArIHRoaXMuZm9ybWF0UGF5bG9hZChtZXNzYWdlLCBcIiAgXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3JtYXR0ZWRNZXNzYWdlICs9IG1lc3NhZ2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvcm1hdHRlZE1lc3NhZ2U7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdFBheWxvYWQocGF5bG9hZDogYW55LCBpbmRlbnQ6IHN0cmluZyA9IFwiXCIpOiBzdHJpbmcge1xuICAgIGlmICh0eXBlb2YgcGF5bG9hZCAhPT0gXCJvYmplY3RcIiB8fCBwYXlsb2FkID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gYCR7aW5kZW50fSR7cGF5bG9hZH1gO1xuICAgIH1cblxuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhwYXlsb2FkKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gYCR7aW5kZW50fSR7a2V5fTpcXG4ke3RoaXMuZm9ybWF0UGF5bG9hZChcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgaW5kZW50ICsgXCIgIFwiXG4gICAgICAgICAgKX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHtpbmRlbnR9JHtrZXl9OiAke3ZhbHVlfWA7XG4gICAgICB9KVxuICAgICAgLmpvaW4oXCJcXG5cIik7XG4gIH1cblxuICBhc3luYyBsb2cobWVzc2FnZTogYW55LCBsb2dMZXZlbDogTG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5zZW5kKG1lc3NhZ2UsIHsgbG9nTGV2ZWwgfSk7XG4gIH1cblxuICBhc3luYyBpbmZvKG1lc3NhZ2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nKG1lc3NhZ2UsIExvZ0xldmVsLklORk8pO1xuICB9XG5cbiAgYXN5bmMgd2FybihtZXNzYWdlOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZyhtZXNzYWdlLCBMb2dMZXZlbC5XQVJOKTtcbiAgfVxuXG4gIGFzeW5jIGVycm9yKG1lc3NhZ2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nKG1lc3NhZ2UsIExvZ0xldmVsLkVSUk9SKTtcbiAgfVxuXG4gIGFzeW5jIGRlYnVnKG1lc3NhZ2U6IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nKG1lc3NhZ2UsIExvZ0xldmVsLkRFQlVHKTtcbiAgfVxuXG4gIHB1YmxpYyBsb2dGcm9tUmVxdWVzdChyZXF1ZXN0OiBJUmVxdWVzdDxMb2dNZXNzYWdlPik6IHZvaWQge1xuICAgIHRoaXMuc2VuZFBhY2thZ2VkKHJlcXVlc3QpO1xuICB9XG59XG4iXX0=